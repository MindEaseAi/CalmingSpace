<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calmify</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#b0e0f0">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Lemon+Milk+Pro:wght@400;700&display=swap');
  body {
    margin: 0;
    font-family: 'Lemon Milk Pro', sans-serif;
    background: linear-gradient(180deg, #b0e0f0 0%, #ffffff 100%);
    overflow-x: hidden;
  }
  .container { max-width: 900px; margin: auto; padding: 20px; text-align: center; }
  h1 { font-size: 2.5rem; color: #2d6a9f; margin-bottom: 1rem; }
  .avatar { width: 120px; height: 120px; margin: auto; }
  .avatar img { width: 100%; animation: float 4s ease-in-out infinite; }
  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
  }
  .textbox { background: rgba(255,255,255,0.8); border-radius: 25px; padding: 20px; margin: 20px 0; box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
  button { font-size: 1.2rem; padding: 10px 20px; border-radius: 15px; border: none; background: #34d399; color: white; cursor: pointer; transition: transform 0.2s; }
  button:hover { transform: scale(1.05); }
  .games { margin-top: 20px; }
  .game { display:none; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.85); border-radius: 20px; box-shadow: 0 5px 12px rgba(0,0,0,0.15); }
  .reward { font-size: 1.5rem; color: #ffb347; margin-top: 20px; display:none; }
  .aurora { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; background: linear-gradient(45deg, rgba(0,200,255,0.1), rgba(255,100,255,0.1), rgba(0,255,100,0.1)); animation: aurora 10s linear infinite; }
  @keyframes aurora { 0%{background-position:0 0;}100%{background-position:100% 100%;} }
</style>
</head>
<body>
<div class="aurora"></div>
<div class="container">
  <h1>Calmify</h1>
  <div class="avatar"><img src="avatar.png" alt="Calming Avatar"></div>
  <div class="textbox">
    <p>How are you feeling today?</p>
    <input type="text" id="userEmotion" placeholder="Enter your feelings..." style="width:80%; padding:10px; border-radius:10px; border:1px solid #ccc;">
    <button id="startSession">Start Session</button>
  </div>

  <div id="reading" class="game">
    <h2>Read this for me</h2>
    <p id="passage" style="font-size:1.2rem; line-height:1.6; cursor:pointer;"></p>
  </div>

  <div id="miniGames" class="games"></div>
  <div class="reward" id="reward">ðŸŽ‰ Great job! ðŸŽ‰</div>
</div>

<script>
  // --- Ambient AI-generated sound simulation ---
  let audioContext = new (window.AudioContext || window.webkitAudioContext)();
  function playCalmSound() {
    let osc = audioContext.createOscillator();
    let gain = audioContext.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(220 + Math.random()*80, audioContext.currentTime);
    gain.gain.setValueAtTime(0.05, audioContext.currentTime);
    osc.connect(gain);
    gain.connect(audioContext.destination);
    osc.start();
    osc.stop(audioContext.currentTime + 10);
    setTimeout(playCalmSound, 5000 + Math.random()*5000);
  }
  playCalmSound();

  // --- Session start ---
  const passages = [
    "Take a deep breath and feel the calm around you.",
    "Imagine a soft cloud floating gently across the sky.",
    "Notice each sound in your environment and let it soothe you.",
    "Focus on the gentle rise and fall of your breath.",
    "Picture a serene lake reflecting the morning sun."
  ];

  const miniGamesList = [
    "ColorMatching","BubblePop","ShapeSorting","MemoryCalm","BreathingGuide",
    "GentlePuzzle","CloudDrift","ZenDrawing","SoundMatching","FloatingLanterns",
    "CalmSequence","LeafCatcher","RaindropCalm","StarTracing","AnimalWalk"
  ];

  function getRandomGames(n) {
    const shuffled = miniGamesList.sort(() => 0.5 - Math.random());
    return shuffled.slice(0,n);
  }

  const userEmotion = document.getElementById('userEmotion');
  const startButton = document.getElementById('startSession');
  const readingDiv = document.getElementById('reading');
  const passageEl = document.getElementById('passage');
  const miniGamesDiv = document.getElementById('miniGames');
  const rewardEl = document.getElementById('reward');

  startButton.addEventListener('click', () => {
    document.querySelector('.textbox').style.display = 'none';
    readingDiv.style.display = 'block';

    // --- Generate random passage ---
    passageEl.textContent = passages[Math.floor(Math.random()*passages.length)];
    passageEl.addEventListener('click', () => {
      passageEl.style.background = '#c4f0c4'; // lights up green
    });

    // --- Start mini-games after reading ---
    setTimeout(() => {
      readingDiv.style.display = 'none';
      miniGamesDiv.style.display = 'block';
      runMiniGames();
    }, 5000); // 5 sec to read, adjust as needed
  });

  function runMiniGames() {
    const sessionGames = getRandomGames(5);
    miniGamesDiv.innerHTML = '';
    let current = 0;

    function showNextGame() {
      if(current >= sessionGames.length) {
        miniGamesDiv.style.display = 'none';
        rewardEl.style.display = 'block';
        setTimeout(()=> rewardEl.style.display='none',5000);
        return;
      }
      const gameName = sessionGames[current];
      const gameDiv = document.createElement('div');
      gameDiv.className = 'game';
      gameDiv.style.display='block';
      gameDiv.textContent = `ðŸŽ® ${gameName} - [Interactive calming mini-game here]`;
      miniGamesDiv.appendChild(gameDiv);

      // Simulate game completion
      setTimeout(() => {
        gameDiv.style.display='none';
        current++;
        showNextGame();
      }, 8000); // each game lasts 8 seconds for demo
    }

    showNextGame();
  }
</script>
</body>
</html>
